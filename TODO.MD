# План улучшения MCP инструментов (Inspired by line_edit)

## Общие принципы реализации
- [x] **TDD подход**: На каждый чих — тест.
- [x] **Валидация**: Проверка целостности после правок.
- [x] **Обратная совместимость**: Старые методы работают.

---

# НОВЫЙ ЭТАП: Глобальная атомарность и UNDO/REDO

## 1. Ядро транзакций (Infrastructure)
- [ ] **TransactionManager**: Центральный менеджер транзакций (begin, commit, rollback).
- [ ] **SnapshotSystem**: Создание резервных копий файлов перед изменением в `.mcp/snapshots/`.
- [ ] **Интеграция с PathSanitizer**: Защита директории метаданных от вмешательства LLM.

## 2. Глобальная Атомарность
- [ ] **Multi-file Batching**: Возможность применять правки сразу к нескольким файлам транзакционно.
- [ ] **Атомарный откат**: Полный возврат всех файлов проекта к исходному состоянию при ошибке в любой части батча.

## 3. История изменений (UNDO/REDO)
- [ ] **UndoTool**: Отмена последней зафиксированной транзакции.
- [ ] **RedoTool**: Повтор отмененной транзакции.
- [ ] **Transaction Journal**: Вывод краткого списка изменений в ответе инструментов.

## 4. Тестирование и верификация
- [ ] **Стресс-тесты**: Откат транзакций при системных сбоях.
- [ ] **Интеграционные тесты**: Проверка корректности работы UNDO после сложных перемещений и правок.
