# План улучшения MCP инструментов (Inspired by line_edit)

## Общие принципы реализации
- [x] **TDD подход**: На каждый чих — тест (граничные кейсы, ошибки, успех).
- [x] **Валидация**: Каждая правка должна завершаться проверкой целостности файла.
- [x] **Обратная совместимость**: Старые способы вызова инструментов продолжают работать.

## 1. EditFileTool: Надежность и контекст
- [x] **Контроль содержимого (`expectedContent`)**
    - Добавлен параметр `expectedContent`.
    - Реализована валидация перед записью.
- [x] **Контекстная адресация (`contextStartPattern`)**
    - Добавлен поиск строки-якоря.
    - Индексы `startLine/endLine` могут быть относительными.
- [x] **Автоматический отступ (Auto-indentation)**
    - Реализовано наследование отступа от предыдущей строки.

## 2. EditFileTool: Расширение операций
- [x] **Типизация операций**
    - Поддержка `replace`, `delete`, `insert_before`, `insert_after`.
- [x] **Пакетное редактирование (Batching)**
    - Поддержка массива `operations`.
    - Автоматический пересчет смещений строк внутри батча.

## 3. ReadFileTool: Умное чтение
- [x] **Чтение вокруг контекста**
    - Добавлены параметры `contextStartPattern` и `contextRange`.

## 4. Общие улучшения
- [x] **Атомарность операций**
    - Файл изменяется только при успехе всех операций в батче (memory-first подход).
